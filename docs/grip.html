<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Mouse Fit — Grip Checker</title>
    <style>
      :root { --bg:#0b0b0f; --fg:#e8e8f0; --pill:#131725; --pillb:#2a2f40; --sub:#a8a8b3; }
      * { box-sizing:border-box; }
      body { margin:0; font-family: system-ui, Segoe UI, Inter, Arial; background:var(--bg); color:var(--fg); }
      header { padding:12px 16px; border-bottom:1px solid #1b1b24; display:flex; gap:10px; align-items:center; }
      header h1 { margin:0; font-size:16px; }
      .pill { padding:2px 8px; border-radius:999px; background:var(--pill); border:1px solid var(--pillb); font-size:12px; color:#b7c8d6; }

      .wrap { position:relative; height:100dvh; }
      video, canvas { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
      video { z-index:0; }
      canvas { z-index:1; }

      .hud { position:absolute; left:0; right:0; bottom:0; padding:12px;
             background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.55) 30%, rgba(0,0,0,0.75) 100%);
             z-index:5; }
      .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
      button, .btn-link { background:#11131b; color:var(--fg); border:1px solid #262b37; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer; text-decoration:none; }
      button.primary { border-color:#1f3a47; background:#0d1a21; }
      select { background:#0e1220; color:#e8eef7; border:1px solid #2b3241; border-radius:10px; padding:8px; }
      .hint { font-size:14px; color:var(--sub); margin:8px 0 10px; }
      .badge { position:absolute; right:10px; top:10px; background:#11131b; border:1px solid #263041; color:#9fcde2; font-size:12px; padding:4px 8px; border-radius:999px; z-index:6; }
      .toast { position:absolute; top:12px; left:50%; transform:translateX(-50%); background:#11131b; border:1px solid #2a3442; color:#cdd8e4; padding:8px 12px; border-radius:10px; font-size:13px; display:none; z-index:7; }
      .countdown { position:absolute; inset:0; display:none; align-items:center; justify-content:center;
                   background:rgba(0,0,0,0.35); font-size:22vmin; font-weight:900; color:#fff;
                   text-shadow:0 2px 10px rgba(0,0,0,0.6); pointer-events:none; z-index:8; }

      .gripGuide { position:absolute; left:6vw; right:6vw; top:10vh; bottom:26vh;
                   border:3px dashed rgba(255,255,255,0.65); border-radius:14px;
                   background:rgba(255,255,255,0.06); display:flex; align-items:center; justify-content:center;
                   pointer-events:none; z-index:2; }
      .label { position:absolute; top:-14px; left:14px; background:#11131b; border:1px solid #2a2f40; color:#cfe9f6;
               font-size:12px; font-weight:700; padding:3px 8px; border-radius:999px; }

      .thumbs { display:flex; gap:10px; margin-top:6px; align-items:center; }
      .thumbs img { width:72px; height:48px; object-fit:cover; border-radius:8px; border:1px solid #2a2f40; background:#0b0b0f; }
      .step-pill { padding:4px 10px; border-radius:999px; background:#0f1524; border:1px solid #2a2f40; font-size:12px; color:#cfe9f6; }

      .btn-link { background:#0d1a21; color:#fff; border:1px solid #1f3a47; }
      .btn-link:hover { filter:brightness(1.05); }
    </style>
  </head>
  <body>
    <header>
      <h1>Mouse Fit — Grip Checker (MVP)</h1>
      <span class="pill">alpha</span>
      <a class="btn-link" href="./index.html">← Back</a>
    </header>

    <div class="wrap">
      <video id="cam" playsinline autoplay muted></video>
      <canvas id="frame"></canvas>

      <div class="gripGuide"><span class="label" id="guideLabel">Step 1/3 — TOP view</span></div>

      <div id="status" class="badge">Live</div>
      <div id="toast" class="toast"></div>
      <div id="countdown" class="countdown">5</div>

      <div class="hud">
        <div class="row" style="gap:12px; margin-bottom:6px;">
          <label>Camera:</label>
          <select id="cameraSelect"></select>
          <button id="refreshCams">Refresh</button>
          <span id="camName" class="pill">—</span>
          <span id="skelState" class="pill">Skeleton: On</span>
          <button id="toggleSkel">Turn off skeleton</button>
          <span class="step-pill" id="stepPill">Step: live</span>
          <span class="step-pill" id="viewPill">View: Top</span>
        </div>

        <div id="hint" class="hint">
          Capture 3 angles: <b>Top</b>, <b>Right</b>, <b>Left</b>. Hold your own mouse in your natural grip inside the dashed box.
        </div>

        <div class="thumbs">
          <img id="thumbTop"   alt="Top"   title="Top">
          <img id="thumbRight" alt="Right" title="Right">
          <img id="thumbLeft"  alt="Left"  title="Left">
        </div>

        <div class="row" id="liveBtns">
          <button id="timer" class="primary">Capture in 5 Seconds (Space)</button>
          <button id="snap">Capture now</button>
        </div>

        <div class="row" id="frozenBtns" style="display:none; gap:8px;">
            <button id="accept">Use This Angle</button>
            <button id="retake">Retake</button>
            <button id="retakeAll">Retake all (clear)</button>
            <button id="classify" disabled>Classify Grip</button>
            <a id="gotoReport" class="btn-link" href="./report.html" style="display:none;">Go to Report</a>
            <span id="resultPill" class="pill">Result: —</span>
        </div>
      </div>
    </div>

    <button id="startCamBtn" style="
      position:fixed; inset:auto 12px 12px auto; z-index:9999;
      background:#0d1a21; color:#fff; border:1px solid #1f3a47;
      padding:10px 14px; border-radius:12px; display:none;">
      Tap to start camera
    </button>

    <script type="module" src="./grip.js"></script>

    <!-- First-run tip for Grip Checker -->
    <div id="introGrip" style="
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55); z-index:10000;">
      <div style="max-width:560px; background:#0f1320; border:1px solid #2a3442; color:#e8eef7;
                  padding:18px 18px 14px; border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.45)">
       <h3 style="margin:0 0 8px; font-size:18px;">Grip cam tips</h3>
        <ul style="margin:6px 0 12px 18px; line-height:1.5;">
          <li>Match the requested view (Top / Right / Left) before capturing.</li>
          <li>Hold your <b>own mouse</b> the way you normally do.</li>
          <li>Including the mouse helps the model classify claw / fingertip / palm (or relaxed claw).</li>
        </ul>
        <div style="display:flex; gap:8px; justify-content:flex-end;">
          <button id="introGripOk" style="background:#0d1a21; color:#fff; border:1px solid #1f3a47;
                  padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer">Got it</button>
        </div>
      </div>
    </div>

    <script>
    (() => {
      const KEY = "mousefit:intro_grip_v1";
      const el = document.getElementById("introGrip");
      if (!localStorage.getItem(KEY)) el.style.display = "flex";
      document.getElementById("introGripOk").onclick = () => {
        localStorage.setItem(KEY, "1");
        el.style.display = "none";
      };
    })();
    </script>
  </body>
</html>
