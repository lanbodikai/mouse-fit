<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mouse Fit — Measurement Report</title>
    <style>
      :root { --bg: #0b0b0f; --fg: #e8e8f0; --sub: #a8a8b3; }
      body { margin: 0; padding: 20px; font-family: system-ui, Segoe UI, Inter, Arial; background: var(--bg); color: var(--fg); }
      h1 { font-size: 18px; margin-bottom: 12px; }
      h2 { font-size: 16px; margin: 24px 0 8px; }
      h3 { font-size: 15px; margin: 12px 0 4px; }
      p { font-size: 14px; margin: 4px 0; }
      .result-container {
        display: grid;
        grid-template-columns: minmax(260px, 420px) 1fr;
        gap: 24px;
        align-items: start;
      } 
      #snapshot {
        width: min(100%, 420px);
        height: auto;
        border: 2px solid #ffffff;
        border-radius: 8px;
        display: block;
      }
      @media (max-width: 720px) {
        .result-container { grid-template-columns: 1fr; }
        #snapshot { width: 100%; }
      }

      ul { list-style: disc; margin: 4px 0 16px 20px; }
      li { margin-bottom: 4px; line-height: 1.4; }
      .note { font-size: 13px; color: var(--sub); margin-top: 4px; }
    </style>
  </head>
  <body>
    <h1>Your Hand Measurement Report</h1>
    <div class="result-container">
      <!-- Snapshot of the hand capture -->
      <img id="snapshot" alt="Hand snapshot" />
      <!-- Measurement details -->
      <div id="measurements">
        <p><strong>Hand length:</strong> <span id="handLength"></span> cm</p>
        <p><strong>Palm width:</strong> <span id="handWidth"></span> cm</p>
        <p><strong>Hand size category:</strong> <span id="handSize"></span></p>
        <p><strong>Suggested grip style(s):</strong> <span id="suggestedGrip"></span></p>
      </div>
    </div>

    <h2>Recommended Mice</h2>
    <p class="note">Top picks for each grip style, sorted by compatibility:</p>
    <h3>Palm Grip Recommendations</h3>
    <ul id="listPalm"></ul>
    <h3>Claw Grip Recommendations</h3>
    <ul id="listClaw"></ul>
    <h3>Fingertip Grip Recommendations</h3>
    <ul id="listFingertip"></ul>

    <script>
      // Retrieve measurement and recommendation data from localStorage
      const measure = JSON.parse(localStorage.getItem("mousefit:measure") || "{}");
      const rec = JSON.parse(localStorage.getItem("mousefit:recs") || "{}");
      // If no data is found (e.g., user navigated here directly), display a message
      if (!measure.len_cm) {
        document.body.innerHTML = "<p>No measurement data found. Please return to the main page to measure your hand.</p>";
      } else {
        // Display snapshot image (if available)
        const snapshotData = localStorage.getItem("mousefit:snapshot");
        if (snapshotData) {
          document.getElementById("snapshot").src = snapshotData;
        } else {
          // If no snapshot was saved, hide the image element
          document.getElementById("snapshot").style.display = "none";
        }
        // Show measured length and width (in centimeters, one decimal place as saved)
        document.getElementById("handLength").textContent = measure.len_cm;
        document.getElementById("handWidth").textContent = measure.wid_cm;
        document.getElementById("handSize").textContent = rec.size;

        // Suggested grip style(s) based on hand size category
        const size = rec.size;
        let gripSuggestion = "";
        if (size === "small") {
          gripSuggestion = "You might find a claw grip comfortable (small hands often work well with claw grip), though palm grip is also a versatile choice.";
        } else if (size === "medium") {
          gripSuggestion = "Palm grip is a versatile choice for medium hands (works well for most hand sizes). You can also experiment with claw or fingertip grip based on personal preference.";
        } else if (size === "large" || size === "xlarge") {
          gripSuggestion = "With a larger hand, a fingertip grip can feel natural, though palm grip (which suits most hand sizes) may also be comfortable.";
        } else {
          gripSuggestion = "Any grip style can be used — choose what feels most natural to you.";
        }
        document.getElementById("suggestedGrip").textContent = gripSuggestion;

        // Helper to create a list item text for a mouse recommendation
        function formatMouseEntry(m) {
          return `${m.brand} ${m.model} — ${m.weight_g} g — ${m.width_mm} mm wide, ${m.height_mm} mm tall — ${m.shape} (${m.tags && m.tags.length ? m.tags.join("/") : "suitable for "+currentGrip+" grip"})`;
        }

        // Populate recommendation lists for each grip category
        for (const grip of ["palm", "claw", "fingertip"]) {
          const listEl = document.getElementById("list" + grip.charAt(0).toUpperCase() + grip.slice(1));
          const topMice = rec.top[grip] || [];
          topMice.forEach(mouse => {
            const li = document.createElement("li");
            // Provide mouse details: name, weight, dimensions, shape, and suggested grip
            const currentGrip = grip.charAt(0).toUpperCase() + grip.slice(1);
            li.textContent = `${mouse.brand} ${mouse.model} — ${mouse.weight_g} g — ${mouse.width_mm} mm wide, ${mouse.height_mm} mm tall — ${mouse.shape} (${currentGrip} grip)`;
            listEl.appendChild(li);
          });
          if (topMice.length === 0) {
            // If no recommendations available (just in case), show a placeholder
            const li = document.createElement("li");
            li.textContent = "No data available";
            listEl.appendChild(li);
          }
        }
      }
    </script>
  </body>
</html>
